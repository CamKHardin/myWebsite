<section id="knowledge">
    <h2>Knowledge Base</h2>
    <ul id="knowledge-list"></ul>
</section>

<script>
    async function fetchNotes(path = '') {
        const repo = 'CamKHardin/Obsidian-Notes';
        const baseUrl = `https://api.github.com/repos/${repo}/contents/${path}`;
        const response = await fetch(baseUrl);
        const files = await response.json();
        const knowledgeList = document.getElementById('knowledge-list');

        for (const file of files) {
            if (file.type === 'dir') {
                // Recursively fetch files in subdirectories
                await fetchNotes(file.path);
            } else if (file.name.endsWith('.md')) {
                const fileResponse = await fetch(file.download_url);
                const fileContent = await fileResponse.text();
                
                const headers = extractHeaders(fileContent);

                // Create list item for each file
                const listItem = document.createElement('li');
                listItem.className = 'knowledge-item'; // Class for search filtering
                listItem.textContent = file.name.replace('.md', '');

                // Create sub-list for the headers (concepts)
                const subList = document.createElement('ul');
                headers.forEach(header => {
                    const subListItem = document.createElement('li');
                    subListItem.className = 'knowledge-item'; // Class for search filtering
                    subListItem.textContent = header;
                    subList.appendChild(subListItem);
                });

                listItem.appendChild(subList);
                knowledgeList.appendChild(listItem);
            }
        }
    }

    // Function to extract headers (lines starting with #, ##, etc.)
    function extractHeaders(content) {
        const lines = content.split('\n');
        const headers = lines.filter(line => line.startsWith('#'));
        return headers.map(header => header.replace(/#/g, '').trim()); // Remove the '#' and extra spaces
    }

    // Search functionality
    document.getElementById('searchBar').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const items = document.getElementsByClassName('knowledge-item');

        for (let i = 0; i < items.length; i++) {
            const text = items[i].textContent.toLowerCase();
            if (text.includes(filter)) {
                items[i].classList.remove('hidden');
            } else {
                items[i].classList.add('hidden');
            }
        }
    });

    // Fetch the notes from the repository
    fetchNotes();
</script>
